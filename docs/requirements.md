# 需求文档: Neko Words

## 1. 项目概况
一个简单的自托管单词本应用 ("Neko Words")，包含一个用于添加单词的命令行工具 (CLI) 和一个用于复习的 Web 前端。

## 2. 用户故事 (User Stories)
- **多语言支持**: 支持添加不同语言的单词 (默认英语，支持日语等)，并在 CLI 中通过标签指定。
- **自动丰富**: 添加单词时，系统自动调用 LLM 生成结构化数据(例句条数不限, 看LLM自己选择生成)：
    - 单词原文
    - 单词翻译 (中文)
    - 例句 1 & 翻译
    - 例句 2 & 翻译
- **复习**: 用户通过 Web 界面或 CLI 复习。
    - **Web**: 支持 "提示" 模式 (先看单词 -> 可选看例句提示 -> 看答案)，并且支持 TTS 语音朗读。
    - **CLI**: 支持 "摸鱼" 复习模式，纯文本交互。
- **批量/交互式添加**: CLI 支持交互模式，可连续粘贴多个单词 (空格分隔) 快速添加。
- **评分**: 评分默认4个: 重来, 困难, 良好, 简单。

## 3. 功能需求

### 3.1 CLI 工具
- **添加单词**:
    - 单词模式: `nekowords add <word> [-t/--tag lang]` (默认 en, 支持jp等)
    - 交互模式: `nekowords add [-t/--tag lang]` (默认 en, 支持jp等) (进入 REPL，支持连续输入/粘贴多个单词，回车提交)
- **复习单词**:
    - 命令: `nekowords review [-t/--tag lang]` (默认 en, 支持jp等)
    - 交互: 纯文本显示单词 -> 按空格显示例句1 -> 再按空格显示单词释义 + 仅例句1和翻译(因为空间有限) -> 按空格默认评分(良)。适合工作时 "偷偷" 复习。
- **配置**: 支持设置默认语言 (如 `en`)。

### 3.2 快捷键(包括网页和cli): 
- 正常逻辑: 显示单词 -> 按空格显示例句 -> 再按空格显示单词释义+例句翻译 -> 按空格评分(默认良)。
- 1/2/3/4, 对应4个评分: 重来, 困难, 良好, 简单。可以直接评分, 然后下一个单词
- 按回车键: 跳过当前, 直接下一个单词。
- 按Ctrl+Z: 显示上一个单词并撤销评分。
- 按Ctrl+C: 退出当前模式。(仅CLI)

### 3.3 后端服务
- **数据结构**: 需存储单词、翻译、多组例句及其翻译、语言标签。
- **API**: 
    - 增加语言字段参数。
    - 优化 LLM Prompt 以返回严格的 JSON 格式 (包含上述字段)。
- **存储**: PostgreSQL，使用 JSONB 或关联表存储例句。

### 3.4 前端应用
- **仪表盘**: 显示待复习单词数量。
- **复习模式 (增强)**:
    - 阶段 1: 显示单词 (支持 TTS 播放)。
    - 阶段 2 (可选): 点击 "提示" 显示例句 (不显示例句翻译)。
    - 阶段 3: 点击 "显示答案" 展示完整翻译、例句和例句翻译。
    - 评分: 重来, 困难, 良好, 简单。
- **语音**: 调用浏览器 TTS API 或后端 TTS 服务朗读单词/句子。

## 4. 非功能需求
- **简单性**: 代码库保持简洁，易于维护。
- **便携性**: 全栈 Docker 化部署。
- **数据管理**: 使用 PostgreSQL 独立服务，便于数据导入导出。
